{% extends "articles/base.html" %}
{% load static %}

{% block title %}Новости{% endblock %}

{% block content %}
<div class="row">
  {% for article in object_list %}
  <div class="col-lg-4 col-sm-6 portfolio-item">
    <div class="card h-100">
      <a href="#"><img class="card-img-top" src="{% get_media_prefix %}{{ article.image }}" alt=""></a>
      <div class="card-body">
        <h4 class="card-title">
          <a href="#">{{ article.title }}</a>
        </h4>
        <p class="card-text">{{ article.text|truncatechars:200 }}</p>

        <!-- Теги с сортировкой: сначала основной, остальные по алфавиту -->
        <div class="mt-2">
          {# Получаем все scopes и сортируем #}
          {% with scopes=article.scopes.all %}
            {# Сначала выводим основной раздел #}
            {% for scope in scopes %}
              {% if scope.is_main %}
                <span class="badge badge-primary">{{ scope.tag.name }}</span>
              {% endif %}
            {% endfor %}

            {# Затем остальные разделы по алфавиту #}
            {% for scope in scopes %}
              {% if not scope.is_main %}
                <span class="badge badge-secondary">{{ scope.tag.name }}</span>
              {% endif %}
            {% endfor %}
          {% endwith %}
        </div>

        <small class="text-muted">{{ article.published_at|date:"d.m.Y" }}</small>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}